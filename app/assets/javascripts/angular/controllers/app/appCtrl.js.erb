controllers.controller('SearchProductsCtrl',['$scope', '$location','ProductService','$dialog','SearchService','AffiliateService','$cookieStore',function($scope, $location, ProductService, $dialog, SearchService, AffiliateService,$cookieStore){

 	$scope.productService = ProductService;
	$scope.products = ProductService.products;
	$scope.productsDisplayed = ProductService.productsDisplayed;

	$scope.searchService = SearchService;
	$scope.currentSearch = SearchService.currentSearch;

	if ($cookieStore.get('currentSearch')==null){
		$location.path("/home");
	}

	$scope.searchService.populateSearch();
	$scope.productService.getProductsByCurrentSearch();

	AffiliateService.applyAffiliateLinks();
  
	$scope.getProducts = function(productType){
		$scope.searchService.saveInitialSearch(productType);
		$location.path('/app');
		AffiliateService.applyAffiliateLinks();
	}

	$scope.showMore = function(){
		$scope.productsDisplayed += 6;
		AffiliateService.applyAffiliateLinks();
	}
    
	$scope.displayProduct = function(product){
		var dialogOpts = {
			resolve: {
				product: function(){
					return product;
				}
			},
			dialogFade: true,
			controller: 'DialogCtrl'
		};
		var dialog = $dialog.dialog(dialogOpts);
		dialog.open('<%= asset_path('angular/templates/productModal.html') %>');
	}

	$scope.filter = function(type){
    $scope.currentSearch.modal = type;
    var currentSearch = $scope.currentSearch;
		var opts = {
			resolve: {
				currentSearch: function(){
					return currentSearch;
				}
			},
			backdropClick: false,
			dialogFade: true,
			controller: 'DialogSearchFilterCtrl'
		};

		var dialog = $dialog.dialog(opts);
		dialog.open('<%= asset_path('angular/templates/filterPopUp.html') %>');


	}
}])
.controller('AttributeCtrl', ['$scope', '$dialog','FilterDataService', function($scope, $dialog, FilterDataService){

	$scope.attributes = FilterDataService.attributes;

	$scope.filter = function(type){

		$scope.attributes.modal = type;

		var attributes = $scope.attributes;

		var opts = {
			resolve: {
				attributes: function(){
					return attributes;
				}
			},
			backdropClick: false,
			dialogFade: true,
			controller: 'DialogFilterCtrl'
		};
		var dialog = $dialog.dialog(opts);
		dialog.open('<%= asset_path('angular/templates/filterModal.html') %>');
	}
}])
.controller('DialogCtrl', ['$scope', 'product', function($scope, product){
	$scope.product = product;
}])
.controller('DialogSearchFilterCtrl',['$scope', 'dialog', 'currentSearch', 'ProductService','AffiliateService','SearchService', function($scope, dialog, currentSearch, ProductService, AffiliateService, SearchService){
	$scope.currentSearch = currentSearch;

	$scope.close = function(type){
		console.log('closed dialog');
  	SearchService.saveCurrentSearchInSession(currentSearch);
  	ProductService.getProductsByCurrentSearch(currentSearch);
  	AffiliateService.applyAffiliateLinks();
		dialog.close();
	}
}]);







